#define BLYNK_PRINT Serial
#define BLYNK_TEMPLATE_ID "TMPL3PeCoy7KK"   // replace with your Template ID (optional)
#define BLYNK_TEMPLATE_NAME "Weather Station"   // replace with your device name (optional)

#include <WiFi.h>
#include <WiFiClient.h>
#include <BlynkSimpleEsp32.h>
#include "Arduino.h"
#include "DHT.h"
#include "BMP085.h"
#include <Wire.h>

// --- Replace these with your own credentials ---
char auth[] = "YC9DYkICMUUmNVaLtckIdZDeNu-g-Oe_";   // Blynk auth token
char ssid[] = "Galaxy S23 4BD5";         // Wi-Fi SSID
char pass[] = "harsh777";     // Wi-Fi password

// --- Sensors & pins ---
#define DHTPIN 5
#define DHTTYPE DHT11
//#define DHTTYPE DHT22
DHT dht(DHTPIN, DHTTYPE);

BMP085 myBarometer; // BMP085 object

// Variables to store sensor values
float temperature = 0.0;
float humidity = 0.0;
float pressure = 0.0; // in Pascals
float mbar = 0.0;     // in mbar / hPa

BlynkTimer timer;

void sendSensor() {
  // Read DHT
  humidity = dht.readHumidity();
  temperature = dht.readTemperature();

  if (isnan(humidity) || isnan(temperature)) {
    Serial.println("Failed to read from DHT sensor!");
  } else {
    Serial.print("Temperature: "); Serial.print(temperature); Serial.println(" Â°C");
    Serial.print("Humidity: ");    Serial.print(humidity);    Serial.println(" %");
    Blynk.virtualWrite(V0, temperature);
    Blynk.virtualWrite(V1, humidity);
  }

  // Read BMP085 pressure (library's read sequence)
  long rawPressure = myBarometer.bmp085GetPressure(myBarometer.bmp085ReadUP());
  pressure = (float)rawPressure;     // pressure in Pascals
  mbar = pressure / 100.0;           // convert to mbar/hPa
  Serial.print("Pressure: "); Serial.print(mbar); Serial.println(" mbar");
  Blynk.virtualWrite(V2, mbar);
}

void setup() {
  Serial.begin(115200);
  delay(100);

  Serial.println("Initializing sensors...");
  Wire.begin();            // start I2C (SDA = 21, SCL = 22 on ESP32 default)
  myBarometer.init();      // initialize BMP085
  dht.begin();             // initialize DHT

  // Connect to Blynk
  Serial.println("Connecting to Blynk...");
  Blynk.begin(auth, ssid, pass);

  // Send sensor data every 2000 ms (2 seconds)
  timer.setInterval(2000L, sendSensor);

  Serial.println("Setup complete.");
}

void loop() {
  Blynk.run();
  timer.run();
}